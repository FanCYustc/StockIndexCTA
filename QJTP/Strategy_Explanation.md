# QJTP (区间突破/趋势反转) 策略解释文档

**策略名称**: IM_QJTP (基于线性回归的短期反转/衰竭策略)  
**交易标的**: IM (中证1000股指期货)  
**数据频率**: 分钟线 (1分钟)

## 1. 核心思想

该策略通过**线性回归**（Linear Regression）来捕捉过去一小段时间（5分钟）内的价格趋势强度和稳定性。策略的基本逻辑是寻找趋势的“加速衰竭点”。当市场在过去5分钟呈现稳定的上涨或下跌趋势，并且当前时刻出现加速冲高或杀跌时，策略认为这是一个短期情绪过度释放的信号，从而进行**反向交易**（即涨势加速时做空，跌势加速时做多）。

虽然文件夹名为 `QJTP` (可能指“区间突破”)，但从代码逻辑来看，它更像是一个利用波动率和趋势形态进行的**反转（Mean Reversion）**或**力竭（Exhaustion）**策略。

## 2. 指标计算

### 2.1 基础价格序列 (`x_series`)
策略首先计算每一分钟的**平均价格**作为分析的基础数据：
$$
P_t = \text{Average}(\text{Open}_t, \text{High}_t, \text{Low}_t, \text{Close}_t)
$$
代码实现：`np.nanmean(arr[:, [1, 2, 3, 4]], axis=1)`

### 2.2 趋势拟合 (Linear Regression)
在每一分钟 $t$，策略回溯过去 **5分钟** 的数据（$t-5$ 到 $t-1$）：
1.  **归一化序列**: 取过去5个点的均价序列，除以该序列的均值，进行归一化处理。
2.  **线性回归**: 对这5个点进行线性回归拟合 ($y = kx + b$)。
    *   **斜率 (`coef`)**: 代表趋势的方向和强度。
    *   **拟合优度 (`R2`)**: 代表趋势的稳定性（线性程度）。$R^2$ 越接近 1，说明价格走势越接近直线，趋势越稳定。

### 2.3 当前爆发力度 (`cond`)
计算当前分钟 $t$ 的均价相对于上一分钟 $t-1$ 的涨跌幅：
$$ \text{cond} = \frac{P_t}{P_{t-1}} - 1 $$

## 3. 交易逻辑 (买卖信号)

策略根据 斜率 (`coef`)、拟合优度 (`R2`) 和 当前涨跌幅 (`cond`) 综合判断。

### 3.1 做空信号 (Short)
当满足以下所有条件时，发出做空信号：
1.  **趋势向上**: `coef >= 0.0005` (过去5分钟处于较强的上涨趋势)
2.  **趋势稳定**: `R2 > 0.5` (上涨走势比较平滑稳定)
3.  **加速冲高**: `cond > 0.001` (当前分钟涨幅超过 0.1%)

**操作**: 开空仓 (或持有空仓)。  
**仓位大小**: `sig = -1 * R2` (趋势越稳定，做空仓位越重，最高 1.0)

> **逻辑解释**: 市场已经稳定上涨了一段时间，突然再次加速大涨，被视为买盘力量的集中释放和潜在的力竭点，因此反向做空。

### 3.2 做多信号 (Long)
当满足以下所有条件时，发出做多信号：
1.  **趋势向下**: `coef <= -0.0005` (过去5分钟处于较强的下跌趋势)
2.  **趋势稳定**: `R2 > 0.5` (下跌走势比较平滑稳定)
3.  **加速杀跌**: `cond <= -0.001` (当前分钟跌幅超过 0.1%)

**操作**: 开多仓 (或持有多仓)。  
**仓位大小**: `sig = 1 * R2` (趋势越稳定，做多仓位越重，最高 1.0)

> **逻辑解释**: 市场已经稳定下跌了一段时间，突然再次加速大跌，被视为恐慌盘的集中释放和潜在的超卖点，因此反向做多。

### 3.3 空仓/平仓
如果不满足上述任一条件，策略持仓归零 (`sig = 0`)。这意味着该策略只在特定的“趋势末端加速”形态下持仓，其余时间空仓等待。

## 4. 总结

*   **策略类型**: 短线反转 / 逆势策略
*   **关键参数**:
    *   回溯窗口: 5分钟
    *   斜率阈值: $\pm 0.0005$
    *   R2阈值: $0.5$
    *   爆发阈值: $\pm 0.1$
*   **优点**: 试图捕捉非理性的情绪释放点，盈亏比通常较高。利用 $R^2$ 动态调整仓位，增加了信号的可信度权重。
*   **风险**: 在超级单边行情中（例如涨停板或重大利好导致的持续逼空），“加速”之后可能不仅不反转，反而会继续加速，导致逆势亏损。
